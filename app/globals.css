@import "tailwindcss";

/* ─── Dark mode: class-based strategy ─── */
@variant dark (&:where(.dark, .dark *));

/* ─── Theme: design tokens (migrated from tailwind.config.ts + shadcn/ui) ─── */
@theme {
  /* App tokens */
  --color-surface: hsl(var(--surface));
  --color-foreground: hsl(var(--foreground));
  --color-card: hsl(var(--card));
  --color-accent: hsl(var(--accent));
  --color-muted: hsl(var(--muted));
  --color-border: hsl(var(--border));
  --color-success: hsl(var(--success));
  --color-danger: hsl(var(--danger));

  /* shadcn/ui standard tokens */
  --color-background: hsl(var(--surface));
  --color-card-foreground: hsl(var(--foreground));
  --color-primary: hsl(var(--accent));
  --color-primary-foreground: hsl(var(--primary-foreground));
  --color-secondary: hsl(var(--muted));
  --color-secondary-foreground: hsl(var(--foreground));
  --color-muted-foreground: hsl(var(--muted-foreground));
  --color-accent-foreground: hsl(var(--accent-foreground));
  --color-destructive: hsl(var(--danger));
  --color-ring: hsl(var(--accent));
  --color-input: hsl(var(--border));

  --shadow-soft: 0 8px 30px rgba(0, 0, 0, 0.08);
  --animate-fade-up: fade-up 500ms ease-out both;
}

@keyframes fade-up {
  0% {
    opacity: 0;
    transform: translateY(10px);
  }

  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ─── CSS Variables: Light ─── */

:root {
  --surface: 201 45% 98%;
  --foreground: 218 36% 16%;
  --card: 0 0% 100%;
  --accent: 154 61% 37%;
  --muted: 212 40% 94%;
  --border: 212 24% 85%;
  --success: 154 61% 37%;
  --danger: 0 72% 50%;
  --primary-foreground: 0 0% 100%;
  --muted-foreground: 240 3.8% 46.1%;
  --accent-foreground: 0 0% 100%;
  --proposal-cta: 49 106 216;
  --proposal-cta-hover: 43 94 192;
  --proposal-cta-border: 41 90 184;
  --proposal-cta-ring: 92 139 226;
  --proposal-cta-foreground: 255 255 255;
  --role-member: 154 61% 37%;
  --role-oversight: 210 60% 45%;
  --role-admin: 38 90% 50%;
  --role-manager: 262 60% 55%;
}

/* ─── CSS Variables: Dark ─── */

.dark {
  --surface: 219 31% 11%;
  --foreground: 204 36% 96%;
  --card: 222 30% 15%;
  --accent: 154 56% 44%;
  --muted: 220 21% 20%;
  --border: 220 16% 27%;
  --success: 154 56% 44%;
  --danger: 0 78% 62%;
  --primary-foreground: 0 0% 100%;
  --muted-foreground: 240 5% 64.9%;
  --accent-foreground: 0 0% 100%;
  --proposal-cta: 63 128 222;
  --proposal-cta-hover: 78 140 229;
  --proposal-cta-border: 111 160 233;
  --proposal-cta-ring: 162 196 245;
  --proposal-cta-foreground: 236 245 255;
  --role-member: 154 56% 44%;
  --role-oversight: 210 55% 55%;
  --role-admin: 38 85% 58%;
  --role-manager: 262 55% 65%;
}

/* ─── Base overrides ─── */

* {
  border-color: hsl(var(--border));
}

html {
  background-color: hsl(var(--surface));
}

body {
  color: hsl(var(--foreground));
  background:
    radial-gradient(circle at 5% 0%, hsl(154 100% 92% / 0.65), transparent 38%),
    radial-gradient(circle at 95% 10%, hsl(43 100% 90% / 0.72), transparent 34%),
    linear-gradient(180deg, hsl(var(--surface)), hsl(210 35% 96%));
  font-family: "Avenir Next", var(--font-inter), "Trebuchet MS", "Gill Sans", sans-serif;
  min-height: 100vh;
}

.dark body {
  background:
    radial-gradient(circle at 8% 2%, hsl(154 61% 18% / 0.4), transparent 35%),
    radial-gradient(circle at 96% 8%, hsl(35 86% 24% / 0.45), transparent 30%),
    linear-gradient(180deg, hsl(var(--surface)), hsl(220 24% 9%));
}

/* ─── Reusable utilities (v4 @utility replaces @apply-based custom classes) ─── */

@utility page-enter {
  animation: fade-up 500ms ease-out both;
}

@utility glass-card {
  @apply border bg-card/90 backdrop-blur-sm;
  box-shadow:
    0 1px 2px rgba(15, 23, 42, 0.04),
    0 8px 24px rgba(15, 23, 42, 0.07);
}

@utility page-stack {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  animation: fade-up 500ms ease-out both;
}

/* ─── Sidebar thin scrollbar ─── */

.sidebar-scroll {
  scrollbar-width: thin;
  scrollbar-color: transparent transparent;
}

.sidebar-scroll:hover {
  scrollbar-color: hsl(var(--border)) transparent;
}

.sidebar-scroll::-webkit-scrollbar {
  width: 4px;
}

.sidebar-scroll::-webkit-scrollbar-track {
  background: transparent;
}

.sidebar-scroll::-webkit-scrollbar-thumb {
  background: transparent;
  border-radius: 9999px;
}

.sidebar-scroll:hover::-webkit-scrollbar-thumb {
  background: hsl(var(--border));
}

/* ─── Keyframes ─── */

@keyframes sidebar-cta-pulse {
  0% {
    transform: scale(0.92);
  }

  70% {
    transform: scale(1.04);
  }

  100% {
    transform: scale(1);
  }
}

@media (prefers-reduced-motion: reduce) {
  .page-enter {
    animation: none;
  }
}

/* Prevent iOS Safari from zooming when focusing form controls */
@media (hover: none) and (pointer: coarse) {
  input,
  textarea,
  select,
  [inputmode] {
    font-size: 16px !important;
  }
}

/* Better disabled button visibility for outdoor/glare readability */
button:disabled,
[role="button"][aria-disabled="true"] {
  @apply opacity-40;
  filter: grayscale(0.3);
}

/* Staggered card entrance animation */
@media (prefers-reduced-motion: no-preference) {
  .page-stack > * {
    animation: fade-up 400ms ease-out both;
  }

  .page-stack > *:nth-child(1) { animation-delay: 0ms; }
  .page-stack > *:nth-child(2) { animation-delay: 60ms; }
  .page-stack > *:nth-child(3) { animation-delay: 120ms; }
  .page-stack > *:nth-child(4) { animation-delay: 180ms; }
  .page-stack > *:nth-child(5) { animation-delay: 240ms; }
  .page-stack > *:nth-child(6) { animation-delay: 300ms; }
}

/* Workspace walkthrough: keep referenced section in view when scrolling */
[data-walkthrough] {
  scroll-margin-top: max(1.5rem, env(safe-area-inset-top));
  scroll-margin-bottom: 1.5rem;
}

/* Tighter stack gap on very small phones (< 360px, e.g. iPhone SE 1st gen) */
@media (max-width: 359px) {
  .page-stack {
    gap: 1rem;
  }
}

/* content-visibility: auto defers off-screen rendering for long lists */
@utility content-auto {
  content-visibility: auto;
  contain-intrinsic-size: auto 200px;
}

/* Mobile: lift toasts above the fixed bottom nav (~72px + safe area) */
@media (max-width: 639px) {
  [data-sonner-toaster][data-position="bottom-center"] {
    bottom: calc(4.5rem + env(safe-area-inset-bottom)) !important;
  }
}

@media print {
  @page {
    size: A4 portrait;
    margin: 10mm;
  }

  html,
  body {
    background: #fff !important;
  }

  body {
    min-height: auto;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  [data-report-print] {
    gap: 1rem;
    animation: none;
  }

  [data-report-print] .glass-card {
    background: #fff !important;
    backdrop-filter: none !important;
    box-shadow: none !important;
    break-inside: avoid-page;
    page-break-inside: avoid;
  }

  [data-report-print] [data-report-print-summary],
  [data-report-print] [data-report-print-charts] {
    break-inside: avoid-page;
    page-break-inside: avoid;
  }

  [data-report-print] [data-report-print-table-section] {
    break-before: page;
    page-break-before: always;
    break-inside: auto;
    page-break-inside: auto;
  }

  [data-report-print] .overflow-x-auto {
    overflow: visible !important;
  }

  [data-report-print] [data-report-print-table] {
    width: 100% !important;
    min-width: 0 !important;
    table-layout: fixed;
    border-collapse: collapse;
  }

  [data-report-print] [data-report-print-table] th,
  [data-report-print] [data-report-print-table] td {
    padding: 0.42rem 0.45rem;
    font-size: 0.68rem;
    line-height: 1.35;
    vertical-align: top;
    white-space: nowrap;
    overflow-wrap: normal;
    word-break: normal;
  }

  [data-report-print] [data-report-print-table] thead {
    display: table-header-group;
  }

  [data-report-print] [data-report-print-table] tfoot {
    display: table-footer-group;
  }

  [data-report-print] [data-report-print-table] tr {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  [data-report-print] [data-report-print-table] th {
    font-size: 0.64rem;
    letter-spacing: 0.02em;
    text-transform: uppercase;
  }

  [data-report-print] [data-report-print-table] th:nth-child(1),
  [data-report-print] [data-report-print-table] td:nth-child(1) {
    width: 31%;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
  }

  [data-report-print] [data-report-print-table] th:nth-child(2),
  [data-report-print] [data-report-print-table] td:nth-child(2) {
    width: 11%;
  }

  [data-report-print] [data-report-print-table] th:nth-child(3),
  [data-report-print] [data-report-print-table] td:nth-child(3) {
    width: 12%;
  }

  [data-report-print] [data-report-print-table] th:nth-child(4),
  [data-report-print] [data-report-print-table] td:nth-child(4) {
    width: 12%;
    text-align: right;
  }

  [data-report-print] [data-report-print-table] th:nth-child(5),
  [data-report-print] [data-report-print-table] td:nth-child(5) {
    width: 12%;
  }

  [data-report-print] [data-report-print-table] th:nth-child(6),
  [data-report-print] [data-report-print-table] td:nth-child(6) {
    width: 22%;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
  }

  [data-report-print] [data-report-print-table] td > p {
    margin: 0;
  }

  [data-report-print] [data-report-print-charts] > section {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 0.75rem;
  }

  [data-report-print] [data-report-print-charts] .glass-card {
    min-width: 0;
  }

  [data-report-print] [data-report-print-charts] .h-\[260px\],
  [data-report-print] [data-report-print-charts] .sm\:h-\[280px\] {
    height: 198px !important;
  }

  [data-report-print] [data-report-print-charts] .h-\[200px\],
  [data-report-print] [data-report-print-charts] .sm\:h-\[220px\] {
    height: 170px !important;
  }

  [data-report-print] [data-report-print-charts] .recharts-wrapper,
  [data-report-print] [data-report-print-charts] .recharts-surface {
    max-width: 100%;
  }
}

